generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============= ENUMS =============

enum UserRole {
  ADMIN
  AGENT
  USER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BLOCKED
}

enum Platform {
  FACEBOOK
  GOOGLE
  TIKTOK
  SNAPCHAT
  BING
}

enum AccountStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  REFUND
  TRANSFER
  CREDIT
}

enum TransactionStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum PayLinkType {
  INDIVIDUAL
  COMPANY
}

enum PayLinkStatus {
  ACTIVE
  INACTIVE
}

enum DomainStatus {
  PENDING
  APPROVED
  REJECTED
}

// ============= MODELS =============

model User {
  id                String      @id @default(cuid())
  email             String      @unique
  password          String
  plaintextPassword String?
  username          String
  phone             String?
  phone2            String?
  realName          String?
  address           String?
  website           String?
  profileImage      String?
  uniqueId          String      @unique @default(cuid())

  role              UserRole    @default(USER)
  status            UserStatus  @default(ACTIVE)

  // Wallet
  walletBalance     Decimal     @default(0) @db.Decimal(12, 2)
  openingFee        Decimal     @default(0) @db.Decimal(10, 2)

  // Platform fees (for agents)
  fbFee             Decimal     @default(0) @db.Decimal(10, 2)
  fbCommission      Decimal     @default(0) @db.Decimal(10, 2)
  googleFee         Decimal     @default(0) @db.Decimal(10, 2)
  googleCommission  Decimal     @default(0) @db.Decimal(10, 2)
  tiktokFee         Decimal     @default(0) @db.Decimal(10, 2)
  tiktokCommission  Decimal     @default(0) @db.Decimal(10, 2)
  snapchatFee       Decimal     @default(0) @db.Decimal(10, 2)
  snapchatCommission Decimal    @default(0) @db.Decimal(10, 2)
  bingFee           Decimal     @default(0) @db.Decimal(10, 2)
  bingCommission    Decimal     @default(0) @db.Decimal(10, 2)

  // 2FA
  twoFactorEnabled  Boolean     @default(false)
  twoFactorSecret   String?

  // Remarks
  personalRemarks   String?
  contactRemarks    String?

  // Relations
  agentId           String?
  agent             User?       @relation("AgentUsers", fields: [agentId], references: [id])
  users             User[]      @relation("AgentUsers")

  creatorId         String?
  creator           User?       @relation("CreatedUsers", fields: [creatorId], references: [id])
  createdUsers      User[]      @relation("CreatedUsers")

  // Related records
  adAccounts        AdAccount[]
  deposits          Deposit[]
  withdrawals       Withdrawal[]
  refunds           Refund[]
  walletFlows       WalletFlow[]
  payLinks          PayLink[]
  blockHistory      BlockHistory[]  @relation("BlockedUser")
  blockedByHistory  BlockHistory[]  @relation("BlockedBy")

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  @@map("users")
}

model AdAccount {
  id                String        @id @default(cuid())

  // Account Info
  platform          Platform
  accountId         String
  accountName       String
  bmId              String?       // Business Manager ID
  timezone          String?
  currency          String        @default("USD")

  // Status
  status            AccountStatus @default(PENDING)

  // Financials
  totalDeposit      Decimal       @default(0) @db.Decimal(12, 2)
  totalSpend        Decimal       @default(0) @db.Decimal(12, 2)
  balance           Decimal       @default(0) @db.Decimal(12, 2)

  // Owner
  userId            String
  user              User          @relation(fields: [userId], references: [id])

  // Documents
  documents         String?       // JSON array of document URLs

  // Remarks
  remarks           String?
  adminRemarks      String?

  // Related
  deposits          AccountDeposit[]
  refunds           AccountRefund[]

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@map("ad_accounts")
}

model Deposit {
  id                String            @id @default(cuid())

  amount            Decimal           @db.Decimal(12, 2)
  status            TransactionStatus @default(PENDING)

  // Payment details
  paymentMethod     String?
  paymentProof      String?           // Document URL
  transactionId     String?

  // User
  userId            String
  user              User              @relation(fields: [userId], references: [id])

  // Remarks
  remarks           String?
  adminRemarks      String?

  approvedAt        DateTime?
  rejectedAt        DateTime?

  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  @@map("deposits")
}

model Withdrawal {
  id                String            @id @default(cuid())

  amount            Decimal           @db.Decimal(12, 2)
  status            TransactionStatus @default(PENDING)

  // Bank details
  bankName          String?
  accountNumber     String?
  accountHolderName String?
  ifscCode          String?

  // User
  userId            String
  user              User              @relation(fields: [userId], references: [id])

  // Remarks
  remarks           String?
  adminRemarks      String?

  approvedAt        DateTime?
  rejectedAt        DateTime?

  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  @@map("withdrawals")
}

model Refund {
  id                String            @id @default(cuid())

  amount            Decimal           @db.Decimal(12, 2)
  status            TransactionStatus @default(PENDING)

  // Related account
  platform          Platform
  accountId         String?

  // User
  userId            String
  user              User              @relation(fields: [userId], references: [id])

  // Remarks
  reason            String?
  adminRemarks      String?

  approvedAt        DateTime?
  rejectedAt        DateTime?

  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  @@map("refunds")
}

model AccountDeposit {
  id                String            @id @default(cuid())

  amount            Decimal           @db.Decimal(12, 2)
  status            TransactionStatus @default(PENDING)

  // Account
  adAccountId       String
  adAccount         AdAccount         @relation(fields: [adAccountId], references: [id])

  // Remarks
  remarks           String?
  adminRemarks      String?

  approvedAt        DateTime?

  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  @@map("account_deposits")
}

model AccountRefund {
  id                String            @id @default(cuid())

  amount            Decimal           @db.Decimal(12, 2)
  status            TransactionStatus @default(PENDING)

  // Account
  adAccountId       String
  adAccount         AdAccount         @relation(fields: [adAccountId], references: [id])

  // Remarks
  reason            String?
  adminRemarks      String?

  approvedAt        DateTime?

  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  @@map("account_refunds")
}

model WalletFlow {
  id                String          @id @default(cuid())

  type              TransactionType
  amount            Decimal         @db.Decimal(12, 2)
  balanceBefore     Decimal         @db.Decimal(12, 2)
  balanceAfter      Decimal         @db.Decimal(12, 2)

  // Reference
  referenceId       String?         // ID of related transaction
  referenceType     String?         // deposit, withdrawal, refund, etc.

  // User
  userId            String
  user              User            @relation(fields: [userId], references: [id])

  description       String?

  createdAt         DateTime        @default(now())

  @@map("wallet_flows")
}

model PayLink {
  id                String        @id @default(cuid())

  type              PayLinkType
  title             String
  description       String?

  // Bank details
  bankName          String?
  accountNumber     String?
  accountHolderName String?
  ifscCode          String?
  upiId             String?
  qrCode            String?       // QR code image URL

  status            PayLinkStatus @default(ACTIVE)

  // User
  userId            String
  user              User          @relation(fields: [userId], references: [id])

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@map("pay_links")
}

model BlockHistory {
  id                String    @id @default(cuid())

  reason            String?

  // User who was blocked
  userId            String
  user              User      @relation("BlockedUser", fields: [userId], references: [id])

  // Admin/Agent who blocked
  blockedById       String
  blockedBy         User      @relation("BlockedBy", fields: [blockedById], references: [id])

  blockedAt         DateTime  @default(now())
  unblockedAt       DateTime?

  @@map("block_history")
}

model CustomDomain {
  id                String        @id @default(cuid())

  domain            String        @unique
  brandName         String
  logo              String?
  favicon           String?

  status            DomainStatus  @default(PENDING)

  // Applicant email
  applicantEmail    String
  applicantName     String

  adminRemarks      String?

  approvedAt        DateTime?
  rejectedAt        DateTime?

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@map("custom_domains")
}

model SiteSettings {
  id                String    @id @default(cuid())

  domain            String    @unique
  brandName         String
  logo              String?
  favicon           String?

  // Contact
  supportEmail      String?
  supportPhone      String?

  // Social
  facebookUrl       String?
  twitterUrl        String?
  instagramUrl      String?

  // Settings
  maintenanceMode   Boolean   @default(false)

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@map("site_settings")
}

model Module {
  id                Int       @id @default(autoincrement())

  route             String
  label             String
  icon              String

  role              UserRole
  priority          Int       @default(1000)

  isActive          Boolean   @default(true)

  @@map("modules")
}
